<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Podiatry Service Tracker with OCR, Preview & Manual Entry</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 20px;
    }
    table, th, td {
      border: 1px solid #444;
      border-collapse: collapse;
      padding: 8px;
      text-align: center;
    }
    th {
      background-color: #f0f0f0;
    }
    button {
      padding: 5px 10px;
      cursor: pointer;
    }
    button.done {
      background-color: #4CAF50;
      color: white;
    }
    #uploadSection, #previewSection, #manualSection {
      margin-bottom: 20px;
    }
    #status {
      font-style: italic;
      color: #555;
    }
  </style>
  <!-- Include Tesseract.js from CDN -->
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@v2.1.5/dist/tesseract.min.js"></script>
</head>
<body>
  <h1>Podiatry Service Tracker with OCR, Preview & Manual Entry</h1>
  
  <!-- OCR Upload Section -->
  <div id="uploadSection">
    <p>
      Upload a screenshot (image file) containing patient names (one name per line):
    </p>
    <input type="file" id="fileInput" accept="image/*">
    <button id="uploadButton">Upload Screenshot & Process OCR</button>
    <p id="status"></p>
  </div>

  <!-- Preview Sample Names Section -->
  <div id="previewSection">
    <p>
      Preview sample patient names:
    </p>
    <button id="previewButton">Preview Sample Names</button>
  </div>

  <!-- Manual Entry Section -->
  <div id="manualSection">
    <p>
      Manually add a patient name:
    </p>
    <input type="text" id="manualName" placeholder="First Last">
    <button id="manualAddButton">Add Name</button>
  </div>

  <!-- Patients Table -->
  <table id="patientsTable">
    <thead>
      <tr>
        <th>Patient</th>
        <th>Night Splint</th>
        <th>Cam Boots</th>
        <th>Casting</th>
        <th>X-Rays</th>
        <th>Ultrasound</th>
        <th>Routine Care</th>
        <th>Injection</th>
        <th>Ordering Diabetic Shoes</th>
        <th>Nail Procedure</th>
        <th>ASO Brace</th>
      </tr>
    </thead>
    <tbody>
      <!-- Rows will be inserted here -->
    </tbody>
  </table>

  <script>
    // Toggle a button's state between "Mark Done" and "Done"
    function toggleButton(button) {
      if (button.classList.contains('done')) {
        button.classList.remove('done');
        button.textContent = 'Mark Done';
      } else {
        button.classList.add('done');
        button.textContent = 'Done';
      }
    }

    // Create a table row for a given patient name/label
    function createRow(label) {
      const tr = document.createElement('tr');

      // Create the cell for the patient name/label
      const labelTd = document.createElement('td');
      labelTd.textContent = label;
      tr.appendChild(labelTd);

      // Define the list of procedures
      const procedures = [
        'Night Splint', 
        'Cam Boots', 
        'Casting', 
        'X-Rays', 
        'Ultrasound', 
        'Routine Care',
        'Injection',
        'Ordering Diabetic Shoes',
        'Nail Procedure',
        'ASO Brace'
      ];
      
      // Create a button for each procedure
      procedures.forEach(() => {
        const td = document.createElement('td');
        const btn = document.createElement('button');
        btn.textContent = 'Mark Done';
        btn.addEventListener('click', () => toggleButton(btn));
        td.appendChild(btn);
        tr.appendChild(td);
      });
      
      return tr;
    }

    // Populate the table with an array of names (clears current table)
    function populateTable(names) {
      const tbody = document.querySelector('#patientsTable tbody');
      tbody.innerHTML = ''; // Clear existing rows
      names.forEach(name => {
        const trimmedName = name.trim();
        if (trimmedName !== '') {
          tbody.appendChild(createRow(trimmedName));
        }
      });
    }

    // Append a single row (for manual additions)
    function addRow(name) {
      const tbody = document.querySelector('#patientsTable tbody');
      const trimmedName = name.trim();
      if (trimmedName !== '') {
        tbody.appendChild(createRow(trimmedName));
      }
    }

    // --- Event Listeners ---

    // OCR Upload Button
    document.getElementById('uploadButton').addEventListener('click', function() {
      const fileInput = document.getElementById('fileInput');
      const statusElem = document.getElementById('status');
      
      if (fileInput.files.length === 0) {
        alert('Please select an image file first.');
        return;
      }
      
      const file = fileInput.files[0];
      statusElem.textContent = 'Processing OCR, please wait...';

      Tesseract.recognize(
        file,
        'eng',
        { logger: m => console.log(m) }
      )
      .then(({ data: { text } }) => {
        statusElem.textContent = 'OCR processing complete.';
        // Split OCR result into lines assuming one patient per line
        const names = text.split(/\r?\n/);
        populateTable(names);
      })
      .catch(err => {
        console.error(err);
        statusElem.textContent = 'Error during OCR processing.';
      });
    });

    // Preview Button: Loads 10 sample names
    document.getElementById('previewButton').addEventListener('click', function() {
      const sampleNames = [
        'John Doe',
        'Jane Smith',
        'Alice Johnson',
        'Bob Brown',
        'Charlie Davis',
        'Emily Wilson',
        'Frank Miller',
        'Grace Lee',
        'Hannah Taylor',
        'Ian Clark'
      ];
      populateTable(sampleNames);
    });

    // Manual Add Button: Append a new name from input
    document.getElementById('manualAddButton').addEventListener('click', function() {
      const manualInput = document.getElementById('manualName');
      const name = manualInput.value;
      if (name.trim() === '') {
        alert('Please enter a valid name.');
        return;
      }
      addRow(name);
      manualInput.value = ''; // Clear input field
    });
  </script>
</body>
</html>
